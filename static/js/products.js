// const products = [
//   {
//     price: "Rp265.200",
//     image:
//       "https://www.sociolla.com/cdn-cgi/image/w=325,format=auto,dpr=1.45/https://images.soco.id/94adccca-2024-4f4f-b537-c0ca9ea9c4bd-image-0-1730274030667",
//     skin_type: "Kulit Berminyak",
//     brand: "ABIB",
//     title: "Airy Sunstick Smoothing Bar",
//     descriptions:
//       "1.) Airy Sunstick Smoothing Bar adalah tabir surya berbentuk batangan yang portabel, lebar, dan ergonomis untuk wajah dan tubuh guna melindungi kulit Anda dari sinar UVA & UVB\n2.) SPF 50+ Tahan Air selama 80 menit.\n3.) Tabir surya yang sangat ringan tanpa rasa lengket. Tidak menggumpal bahkan setelah beberapa kali pemakaian ulang. Tidak menggumpal bahkan saat diaplikasikan di atas riasan.\n4.) Perawatan matahari sekaligus untuk semua area yang melengkung dan tidak diaplikasikan secara menyeluruh.\n5. Tahan air dan semi matte finish",
//     ingredients:
//       "Dimethicone, Synthetic Wax, Homosalate, Silica, Isoeicosane, Octocrylene, Phenylpropyldimethylsiloxysilicate, Ethylhexyl Salicylate, Isopropyl Palmitate, Diisostearyl Malate, Butyloctyl Salicylate, Isononyl Isononanoate, Butyl Methoxydibenzoylmethane, Phenethyl Benzoate, Diethylhexyl Carbonate, Synthetic Fluorphlogopite, Hydrogenated Vegetable Oil, Polyethylene, Bis-Behenyl/Isostearyl/Phytosteryl Dimer Dilinoleyl Dimer Dilinoleate, Dimethicone/Vinyl Dimethicone Crosspolymer, Ethylene/Propylene Copolymer, Camellia Japonica Seed Oil, Silica Dimethyl Silylate, Dimethicone Crosspolymer, Euphorbia Cerifera (Candelilla) Wax, Vinyl Dimethicone/Methicone Silsesquioxane Crosspolymer, Copernicia Cerifera (Carnauba) Wax Lecithin, Pentaerythrityl Tetra-di-t-butyl Hydroxyhydrocinnamate, Allantoin, Ectoin, Helianthus Annuus (Sunflower) Seed Oil Unsaponifiables",
//     id_item: "0",
//   },
//   {
//     price: "Rp117.150",
//     image:
//       "https://www.sociolla.com/cdn-cgi/image/w=325,format=auto,dpr=1.45/https://images.soco.id/fb8ed0a0-c3de-4213-b6fb-a32691a8af8c-image-0-1727842670728",
//     skin_type: "Kulit Berminyak",
//     brand: "FOCALSKIN",
//     title: "Bubble Blackhead Remover Facial Cleanser",
//     descriptions:
//       "FOCALSKIN Porefying Bubble Cleanser 120g\nManfaat :\nGentle, pembersihan secara mendalam\nMengecilkan pori-pori\nMencerahkan kulit wajah\nHero Ingredients :\n★Decyl Glucoside - APG Surfactant\nSurfaktan yang lebih gentle dibandingkan Amino Acid dan surfaktan lainnya. Dapat membersihkan secara mendalam hingga ke pori-pori.\n★ AHA, BHA, PHA\nDapat mengangkat sel kulit mati dan memperbaiki tekstur kulit kasar dan kulit kusam\n★ Cactus Flower Extract\nMempromosikan regenerasi kulit\n★ Purslane\nMempercepat perbaikan skin barrier\n★ Grape Fruit\nMengencangkan kulit wajah\nTipe jenis kulit untuk pemakaian Porefying Bubble Cleanser Facial Wash :\n- Kulit berminyak/kombinasi bisa menggunakan bubble cleanser setiap hari (1x sehari)\n- Kulit kering/kombinasi kering/berjerawat/sensitif cukup menggunakan 3x dalam seminggu\n- Dilayer dengan pelembab diakhir step skincare",
//     ingredients:
//       "AQUA, DECYL GLUCOSIDEGLYCERINMETHYL PERFLUOROISOBUTYL ETHERDISODIUM COCOAM- PHODIACETATE,DISILOXANEPOLYSORBATE 20 ACRYLATES/C10-30 ALKYL ACRYLATE CROSSPOLYMER PROPANEDIOL, BUTYLENE GLYCOLCOCAMIDOPRO- PYL BETAINE, JUGLANS REGIA SHELL POWDER. PORTULACA OLERACEA EXTRACTHYDROXYACE- TOPHENONE,XANTHAN GUM,GLUCONOLACTONE AMINOMETHYL PROPANOL,LACTIC ACIDSODIUM CHLORIDE,SALICYLIC ACID,SODIUM POLYACRYLATE CITRUS AURANTIUM DULCIS OILPARFUMCENTELLA ASIATICA EXTRACTCAPRYLHYDROXAMIC ACID GLYCERYL CAPRYLATECARAMELTRIETHYLHEX- ANOIN, DIPHENYLSILOXY PHENYL TRIMETHICONE POLYACRYLIC ACID,SCUTELLARIA BAICALENSIS ROOT EXTRACT, POLYGONUM CUSPIDATUM ROOT EXTRACT ARTEMISIA ARGYI LEAF EXTRACTCAMELLIA SINENSIS LEAF EXTRACT GLYCYRRHIZA GLABRA ROOT EXTRACT DIMETHICONE, POLYGLYCERYL-10 MYRISTATE,PROPYLENE GLYCOLROSMARINUS OFFIC INALIS LEAF EXTRACT, CHAMOMILLA RECUTITA FLOWER EXTRACT,ANTHEMIS NOBILIS FLOWER OIL VITIS VINIFERA FRUIT EXTRACTDIATOMACEOUS EARTH,ALUMINUM SULFATEPHENOXYETHANOL, HYDROLYZED OPUNTIA FICUS-INDICA FLOWER EXTRACTETHYLHEXYLGLYCERIN",
//     id_item: "1",
//   },
//   {
//     price: "Rp171.780",
//     image:
//       "https://img.lazcdn.com/g/p/be1dec528039d02b986f31b1be27c064.png_720x720q80.png",
//     skin_type: "Kulit Berminyak",
//     brand: "FOCALSKIN",
//     title: "Oil Control Toner",
//     descriptions:
//       "FOCALSKIN AHA-BHA-PHA Acids Oil Control Toner 120ml\nScience+Natural dual-channel mempromosikan pengelupasan kulit dan membuka fungsi pelembab/hidrasi kulit\nManfaat :\nEfek eksfoliasi ganda pada pori-pori, mempercepat pengelupasan sel kulit mati serta membersihkan pori-pori.\nMengencangkan/Mengecilkan pori-pori, memperbaiki tekstur kulit.\nMenyeimbangkan kadar air dan minyak berlebih, terdapat elemen pengontrol minyak yang menjaga stabilitas kulit.\nMoisturizing / Melembabkan, dengan kombinasi ekstrack tumbuhan yang berfungsi mengunci air secara mendalam.\nHero Ingredients :\n★ AHA.BHA.PHA\nBerfungsi untuk menghilangkan sel kulit mati dari permukaan wajah, menembus sebum dan membersihkan pori-pori secara mendalam, serta eksfoliasi secara ilmiah melindungi kulit sensitif.\n★ HYDROLYZED OPUNTIA FICUS-INDICA FLOWER EXTRACT\nBerfungsi untuk mempercepat pengelupasan sel kulit mati dan pembaharuan sel.\n★ 99.8% NIACINAMIDE\nBerfungsi untuk mencerahkan, mengontrol minyak, mempercepat metabolisme, serta mempercepat pengelupasan stratum korneum melanin.\n★ 1% HAMAMELIS VIRGINIANA EXTRACT\nBerfungsi untuk mengecilkan pori-pori memperbaiki tekstur kulit.\n★ 8% ROSMARINUS OFFICINALIS LEAF WATER\nBerfungsi untuk  menenangkan, melembabkan, serta memperkuat skin barrier.\nCocok untuk semua jenis kulit, terutama yang memiliki kulit berminyak, keratin tebal, pori-pori besar, ketidakseimbangan air-minyak, dan kulit kusam.",
//     ingredients:
//       "AQUA, ROSMARINUS OFFICINALIS LEAFWATER, DIPROPYLENE GLYCOL, NIACINAMIDE, BUTYLENE GLYCOL, 1,2-HEXANEDIOL, GLUCO- NOLACTONE, LACTIC ACID, PHENOXYETHA- NOL, CHLORPHENESIN, PEG-40 HYDROGE- NATED CASTOR OIL, AMINOMETHYL PROPA- NOL, PEG-60 ALMOND GLYCERIDES, CAPRY- LYL GLYCOL, DEXTRIN, SALICYLIC ACID. PROPANEDIOL, GLYCERIN, POLYACRYLATE CROSSPOLYMER-6, BISABOLOL, SESAME AMINO ACIDS, HYDROXYACETOPHENONE, HAMAMELIS VIRGINIANA EXTRACT, CITRUS AURANTIUM DULCIS PEEL OIL, PARFUM. CROCUS SATIVUS FLOWER EXTRACT, SODIUM CITRATE, CAPRYLHYDROXAMIC ACID, DISODI- UM EDTA, CARBOMER, CITRIC ACID, CENTEL- LA ASIATICA EXTRACT, NORDIHYDROGUA- IARETIC ACID, HYDROLYZED OPUNTIA FICUS-INDICA FLOWER EXTRACT, OLEANOLIC ACID, SODIUM METABISULFITE, SCUTELLARIA BAICALENSIS ROOT EXTRACT, POLYGONUM CUSPIDATUM ROOT EXTRACT. CAMELLIA SINENSIS LEAF EXTRACT. GLYCYRRHIZA GLABRA ROOT EXTRACT, ROSMARINUS OFFICINALIS LEAF EXTRACT. CHAMOMILLA RECUTITA FLOWER EXTRACT, ETHYLHEXYL- GLYCERIN, BIOTIN.",
//     id_item: "2",
//   },
//   {
//     price: "Rp59.900",
//     image:
//       "https://www.sociolla.com/cdn-cgi/image/w=325,format=auto,dpr=1.45/https://images.soco.id/d26842d5-f534-475c-8ad1-209072140548-image-0-1725511163745",
//     skin_type: "Kulit Sensitif, Kulit Berminyak",
//     brand: "I'M FROM",
//     title: "Mugwort Sheet Mask",
//     descriptions:
//       "Mugwort Sheet Mask dengan kandungan 93.3% ekstrak Mugwort dari Pulau Ganghwa, lembaran maskernya direndam oleh Mugwort Essence yang diekstraksi dengan metode SLOW RELEASE EXTRACTION™ selama 24 jam untuk menghasilkan ekstrak dengan kandungan bahan aktif yang tinggi.\nMasker ini dibuat dengan lembaran I-CELL yang tipis, transparan, mudah melekat di wajah, ramah lingkungan, rendah akan terkena iritasi, dan direndam dalam essence yang pekat untuk memberikan manfaat bahan aktif langsung ke kulit. Berfungsi untuk memberi perawatan wajah dengan efek calming, purifying dan menghidrasi secara instan pada kulit bermasalah, berjerawat, iritasi, dan sensitif.",
//     ingredients:
//       "Artemisia Princeps Extract(93.31%), Butylene Glycol, 1,2-Hexanediol, Water, Dipropylene Glycol, Glycerin, Hydroxyacetophenone, Carbomer, Arginine, Dipotassium Glycyrrhizate, Hydrolyzed Hyaluronic Acid, PVM/MA Copolymer, Caramel, Juniperus Mexicana Oil, Vetiveria Zizanoides Root Oil, Elettaria Cardamomum Seed Oil, Abies Sibirica Oil, Dextrin",
//     id_item: "3",
//   },
//   {
//     price: "Rp208.000",
//     image:
//       "https://www.sociolla.com/cdn-cgi/image/w=325,format=auto,dpr=1.45/https://images.soco.id/66eeb08d-8cf2-4238-b72f-25fc804f095d-image-0-1719802830170",
//     skin_type: "Kulit Berminyak",
//     brand: "BEAUTY OF JOSEON",
//     title: "Red Bean Water Gel",
//     descriptions:
//       "Red Bean Water Gel adalah pelembab dengan tekstur gel yang kaya akan kelembapan namun tetap terasa ringan di kulit. Memiliki kandungan utama Red Bean yang mengandung saponin untuk mengurangi minyak berlebih di wajah dan Peptide yang baik untuk merawat keremajaan kulit. Kedua kandungan ini bekerjasama untuk menghidrasi dan menutrisi kulit.\nDirekomendasikan untuk: Semua jenis kulit, khususnya kulit yang berminyak\nKey Ingredients:\n1. Haenam Red Bean Extract\nMengurangi sebum berlebih dan merawat elastisitas kulit\n2. Peptide Complex\nMelembabkan kulit dan menjaga kekencangan kulit\nDirekomendasikan untuk: Semua jenis kulit\nKey Ingredients:\n1. Rice Extract + Grain Fermented Extract\nMelembabkan dan mencerahkan kulit\n2. Ethylhexyl Triazone, Diethylamino Hydroxybenzoyl Hexyl Benzoate, Diethylhexyl Butamido Triazone, Methylene Bis-benzotriazolyl Tetramethylbutylphenol\nMelindungi kulit dari efek negatif sinar UVA dan UVB",
//     ingredients:
//       "Phaseolus angularis seed extract (441,000 ppm), water, butylene glycol, glycerin, 1,2-hexanediol, methyl trimethicone, acrylates/c10-30 alkyl acrylate crosspolymer, tromethamine, glyceryl glucoside, c12-14 alketh-12, maltodextrin, ammonium acryloyldimethyltaurate/vp copolymer, dimethicone/vinyl dimethicone crosspolymer, dimethicone crosspolymer, ethylhexylglycerin, betaine, panthenol, allantoin, dipotassium glycyrrhizate, polyquaternium-51, xanthan gum, disodium edta, glyceryl acrylate/acrylic acid copolymer, dioscorea japonica root extract, glucose, sodium citrate, beta-glucan, hydrolyzed corn starch, citric acid, sucrose, caprylyl glycol, helianthus annuus (sunflower) seed oil, tocopherol, cyanocobalamin, glycine, serine, glutamic acid, magnesium ascorbyl phosphate, aspartic acid, leucine, acetyl hexapeptide-8, alanine, lysine, arginine, tyrosine, phenylalanine, proline, threonine, valine, isoleucine, histidine, cysteine, methionine, sh-oligopeptide-1, sh-oligopeptide-2, sh-polypeptide-1",
//     id_item: "4",
//   },
//   {
//     price: "Rp169.150",
//     image:
//       "https://down-id.img.susercontent.com/file/id-11134207-7r98z-m01gzl7u7v7m34",
//     skin_type: "Kulit Berminyak",
//     brand: "ARIUL",
//     title: "Apple Cider All Kill Cleansing Bubble Pads",
//     descriptions:
//       "Apple Cider All Kill Cleansing Bubble Pads adalah pembersih wajah berbentuk cleansing pads yang efektif mengangkat sel kulit mati dan komedo. ",
//     ingredients:
//       "Water, Glycerin, Potassium Cocoyl Glycinate, Lauryl Betaine, Disodium Cocoamphodiacetate, Potassium Cocoate, Sodium Chloride, Polyglyceryl-10 Laurate, Potassium Benzoate, Fragrance, Hexylene Glycol, Citric Acid, Vinegar, Disodium EDTA, Pyrus Malus (Apple) Juice, Pyrus Malus (Apple) Fruit Extract, Butylene Glycol, 1,2-Hexanediol, Gluconolactone, Centella Asiatica ExtractWater, Glycerin, Potassium Cocoyl Glycinate, Lauryl Betaine, Disodium Cocoamphodiacetate, Potassium Cocoate, Sodium Chloride, Polyglyceryl-10 Laurate, Potassium Benzoate, Fragrance, Hexylene Glycol, Citric Acid, Vinegar, Disodium EDTA, Pyrus Malus (Apple) Juice, Pyrus Malus (Apple) Fruit Extract, Butylene Glycol, 1,2-Hexanediol, Gluconolactone, Centella Asiatica Extract",
//     id_item: "5",
//   },
// ];

let products;
async function fetchProducts() {
  try {
    const response = await fetch("./static/data/products.json", {
      cache: "no-cache",
    });
    products = await response.json();
  } catch (err) {
    console.error("Error fetching products:", err);
  }
}

fetchProducts();

// Render products card (adapted for new array `products`)
function renderProductCard(p) {
  return `
  <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
    <img src="${p.image || ""}" alt="${
    p.title
  }" class="mt-2 w-full h-48 object-contain" />
    <div class="p-6">
      <div class="flex items-center justify-between mb-2">
        <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-medium">${
          p.skin_type
        }</span>
      </div>
      <h4 class="font-semibold text-gray-800 mb-1 line-clamp-1">${p.title}</h4>
      <p class="text-xs text-gray-500 mb-3">${p.brand}</p>
      <p class="text-sm text-gray-600 mb-4 line-clamp-2">${
        (p.descriptions || "").split("\n")[0]
      }</p>
      <div class="flex justify-between items-center">
        <span class="text-lg font-bold text-orange-600">${p.price || ""}</span>
        <button class="bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-sm hover:bg-orange-200 transition" onclick="showProductDetail('${
          p.id_item
        }')">View</button>
      </div>
    </div>
  </div>`;
}

function mountProductsGrid() {
  const el = document.getElementById("productsGrid");
  if (!el || !Array.isArray(products)) return;
  el.innerHTML = products.map(renderProductCard).join("");
}

// Modal detail untuk data baru
function showProductDetail(id) {
  if (!Array.isArray(products)) return;
  const item = products.find((p) => Number(p.id_item) === Number(id));
  if (!item) return;

  const modal = document.getElementById("productModal");
  const content = document.getElementById("productModalContent");
  if (!modal || !content) return;

  const ingredients = item.ingredients || "";
  const description = (item.descriptions || "").replace(/\n/g, "<br>");

  content.innerHTML = `
    <div class="flex justify-between items-start mb-6">
      <div>
        <h2 class="text-2xl font-bold text-gray-800 mb-1">${item.title}</h2>
        <p class="text-sm text-gray-500">${item.brand} • ${item.skin_type}</p>
      </div>
      <button onclick="closeProductModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
    </div>
    <div class="grid md:grid-cols-2 gap-8">
      <div>
        <img src="${item.image || ""}" alt="${
    item.title
  }" class="p-2 w-full rounded-lg shadow-lg">
      </div>
      <div>
        <div class="mb-6">
          <span class="text-3xl font-bold text-orange-600">${
            item.price || ""
          }</span>
        </div>
        <div class="mb-6">
          <h3 class="font-semibold text-lg mb-3">Description</h3>
          <p class="text-gray-700 text-sm leading-relaxed">${description}</p>
        </div>
        <div class="mb-6">
          <h3 class="font-semibold text-lg mb-3">Ingredients</h3>
          <p class="text-gray-700 text-sm whitespace-pre-line break-words">${ingredients}</p>
        </div>
        <button class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition font-semibold">Add to Cart</button>
      </div>
    </div>
  `;

  modal.classList.remove("hidden");
  modal.addEventListener(
    "click",
    (e) => {
      if (e.target === modal) closeProductModal();
    },
    { once: true }
  );
}

function closeProductModal() {
  const modal = document.getElementById("productModal");
  if (modal) modal.classList.add("hidden");
}
